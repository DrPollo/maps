angular.module("firstlife.directives").directive("membersCounter",function(){return{restrict:"EG",scope:{id:"=id",details:"=details"},templateUrl:"/templates/map-ui-template/membersCounter.html",controller:["$rootScope","$scope","$log","$filter","groupsFactory",function(e,t,o,r,i){function a(){t.counter=1,t.members.subscribe(function(e){t.counter=e.length},function(e){o.error("groupsFactory, getMembers, error ",e)},function(){o.debug("groupsFactory, getMembers, complete ")})}t.members=i.getMembersRx(t.id),a(),t.$on("$destroy",function(e){if(!e.preventDestroyMembersCounter){if(e.preventDestroyMembersCounter=!0,t.members)try{t.members.unsubscribe()}catch(e){}delete t}}),t.$watch("id",function(e,o){e!=o&&(t.members=i.getMembersRx(t.id),a())}),e.$on("groupReset",function(e,o){e.preventGroupResetCounter||(e.preventGroupResetCounter=!0,t.members=o.observable,a())})}]}}).directive("membersList",function(){return{restrict:"EG",scope:{id:"=id",details:"=details"},templateUrl:"/templates/map-ui-template/membersList.html",controller:["$rootScope","$scope","$log","$filter","groupsFactory","MemoryFactory",function(e,t,o,r,i,a){function n(){t.role=!1,t.counter=[],t.membersList=[],t.members.subscribe(function(e){if(t.membersList=e,t.user){var o=e.map(function(e){return e.memberId}).indexOf(t.user.id);o>-1&&(t.role=e[o].role?e[o].role:"member")}},function(e){o.error("groupsFactory, getMembers, error ",e)},function(){})}t.user=a.get("user"),t.$on("$destroy",function(e){if(!e.preventDestroyMembersList){if(e.preventDestroyMembersList=!0,t.members)try{t.members.unsubscribe()}catch(e){}delete t}}),t.$watch("id",function(e,t){e!=t&&n()}),e.$on("groupReset",function(e,o){e.preventMembersResetCounter||(e.preventMembersResetCounter=!0,t.members=o.observable,n())}),t.members=i.getMembersRx(t.id),n(),t.deleteMember=function(e,t){i.removeUser(e,t).then(function(){n()},function(e){o.error("memers list, groupsFactory.removeUser, errore ",e)})}}]}});