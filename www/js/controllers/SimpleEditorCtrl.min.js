angular.module("firstlife.controllers").controller("SimpleEditorCtrl",["$scope","$rootScope","$state","$q","$ionicModal","$ionicPopover","$ionicActionSheet","$ionicLoading","$ionicPopup","$timeout","$filter","$log","myConfig","ImageService","entityFactory","MapService","MemoryFactory","AuthService","SimpleEntityFactory","EntityService",function(e,t,o,r,a,i,n,l,s,c,d,f,u,g,p,m,v,E,y){function L(e){h.type=types[e.type],h.simpleEntity={type:e.type,parent:e.entity,label:h.type.label,contentKey:h.type.contentKey};for(var t in h.type.fields)h.simpleEntity[t]=h.type.fields[t].default}function A(){e.config.dev&&C&&console.log("SimpleEditorCtrl, init entita init: ",h.simpleEntity),a.fromTemplateUrl("templates/form/simpleEditor.html",{scope:e,animation:"fade-in",backdropClickToClose:!0,hardwareBackButtonClose:!0,focusFirstInput:!0}).then(function(e){h.modal=e,h.modal.show()})}function k(){f.debug("SimpleEditorCtrl, save entity, self.simpleEntity: ",h.simpleEntity),I(),y.add(h.simpleEntity.parent,h.simpleEntity,h.type.key).then(function(e){f.debug("SimpleEditorCtrl, addComment, response: ",e),O(),h.abort()},function(e){f.error("SimpleEditorCtrl, addComment, error: ",e),O(),R()})}function I(e){e&&"undefined"!==e||(e="Operazione in corso..."),l.show({template:e})}function O(){l.hide()}function R(t){t||(t={}),t.title||(t.title=d("translate")("ERROR")),t.text||(t.text=d("translate")("UNKNOWN_ERROR"));var o=s.alert({title:t.title,template:t.text});o.then(function(){e.config.dev&&C&&console.log("Allert con contenuto: ",t)})}var h=this,C=!1;h.config=u,h.simpleEntity={},h.now=new Date,h.currentUser=v.get("user"),h.types=h.config.types.simpleEntities,h.createMode=!0,e.$on("simpleInsert",function(e,t){e.defaultPrevented||(C&&console.log("SimpleEditorCtrl, listner ",e," parametri ",t),e.defaultPrevented=!0,t&&(L(t),h.createMode=!0,A()))}),e.$on("simpleUpdate",function(e,t){e.defaultPrevented||(C&&console.log("SimpleEditorCtrl, listner ",e," parametri ",t),I(),e.defaultPrevented=!0)}),h.save=function(){e.config.dev&&C&&console.log("SimpleEditorCtrl, salvo l'entita': ",h.simpleEntity),k()},h.abort=function(){e.config.dev&&C&&console.log("SimpleEditorCtrl, chiudo la modal"),h.modal&&(h.modal.remove(),h.modal=null),delete h.simpleEntity}}]);