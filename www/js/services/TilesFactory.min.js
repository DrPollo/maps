angular.module("firstlife.factories").factory("tilesFactory",["$http","$q","$rootScope","$log","$filter","myConfig","MemoryFactory","rx",function(e,i,t,o,n,r){function s(t,n,r){var a=i.defer(),l=bbox.replace("{x}",t).replace("{y}",n).replace("{z}",r),s={url:l,method:"get",headers:{"Content-Type":"application/json"},data:""};return e(s).then(function(e){var i=t+":"+n+":"+r;e.data.key=i,data=data.concat([e.data]),o.debug("data",data.length),a.resolve(this.data)},function(e){a.reject(e)}),a.promise}function c(e,i,t){function a(e,i){return o.debug("unsubscribe? ",e.key,i," =",e.key===i),e.key===i?(o.debug("eliminato ",i),!1):!0}var r=e+":"+i+":"+t;this.data=n("filter")(this.data,a,r),o.debug("data",data.length)}return config=r,bbox=config.backend_things.concat("/bb/{z}/{x}/{y}"),this.index={},data=[],{subscribe:function(e,i,t){return s(e,i,t)},unsubscribe:function(e,i,t){return c(e,i,t)},data:function(){return data}}}]);