L.TileLayer.Functional=L.TileLayer.extend({_tileFunction:null,initialize:function(e,t){this._tileFunction=e,L.TileLayer.prototype.initialize.call(this,null,t)},getTileUrl:function(e){var i=(L.CRS.EPSG4326,this._map),o=i.options.crs,n=this.options.tileSize,r=e.z,a=e.multiplyBy(n),l=a.add(new L.Point(n,n)),s=o.project(i.unproject(a,r)),c=o.project(i.unproject(l,r)),u=([s.x,c.y,c.x,s.y].join(","),{crs:o,nw:s,se:c,z:r,y:this.options.tms?this._tileNumBounds.max.y-e.y:e.y,x:e.x});return this._tileFunction({view:u,map:i})},_update:function(e){try{console.error(e.target);var t=e.target.map,i=t.options.crs,o=this.options.tileSize;console.error("update!!!",t,i,o)}catch(e){}},_loadTile:function(e,t){e._layer=this,e.onload=this._tileOnLoad,e.onerror=this._tileOnError,this._adjustTilePoint(t),this.getTileUrl(t)}}),L.tileLayer.functional=function(e,t){return new L.TileLayer.Functional(e,t)};