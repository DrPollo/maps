<ion-modal-view>
    <ion-header-bar class="modal-header" style="position:relative;">
        <h1 class="title title-modal">{{infoPlace.marker.name}}</h1>
        <div class="buttons">
            <button ng-if="isLoggedIn && (checkPerms['u']||checkPerms['d'])" class="button button-clear icon ion-android-more-vertical" on-tap="openPopover($event)"></button>
        </div>
        <div class="flex-container flex-container-style fixed-height" style="position:fixed;top:15px;right:40px;">
            <div class="flex-item">
                <button class="button button-float" style="min-height:50px;min-width:50px;" ng-click="addChildEntity()">
                    <i class="icon ion-plus-round"></i>
                </button>
            </div>
        </div>
    </ion-header-bar>
    <ion-content scroll-event-interval="10">
        <div class="top-modal">
            <div ng-if="infoPlace.marker.valid_from || infoPlace.marker.valid_to || currentType.show_author" class="modal-subheader">
                <span ng-if="currentType.show_author" class="username modal-subheader-item">
                    {{infoPlace.marker.display_name}}
                </span>
                <span class="valid-time modal-subheader-item">
                    <i class="icon ion-android-time"></i>
                    <span ng-if="infoPlace.marker.valid_from">
                        {{'FROM'|translate}} {{infoPlace.marker.valid_from | date:'(HH:mm) dd/MM/yyyy'}}
                    </span>
                    <span ng-if="infoPlace.marker.valid_to && infoPlace.marker.valid_from"> - </span>
                    <span ng-if="infoPlace.marker.valid_to">
                        {{'TO'|translate}} {{infoPlace.marker.valid_to| date:'(HH:mm) dd/MM/yyyy'}}
                    </span>
                </span>
            </div>
            <div ng-if="infoPlace.marker.category || infoPlace.marker.type_info" class="modal-subheader">
                <span ng-repeat="icon in infoPlace.marker.icons" class="modal-subheader-item">
                    <i class="icon {{icon.icon}}"  style="color:{{icon.color}}"></i>
                    <span ng-if="!isMobile">{{icon.name |translate}}</span>
                </span>
                <members-counter id="infoPlace.marker.id" details="infoPlace.marker.type_info.properties.members" ng-if="infoPlace.marker.type_info.properties.members"></members-counter>
                <subscribers-counter ng-if="infoPlace.marker.type_info.acts.subscribe" id="infoPlace.marker.id" details="infoPlace.marker.type_info.acts.subscribe"></subscribers-counter>
            </div>
            <div class="tag-list content" ng-if="infoPlace.marker.tags.length > 0" >
                <span class="tags">
                    <span ng-repeat="tag in infoPlace.marker.tags track by $index" class="tag" style="background-color:{{infoPlace.marker.icons[0].color}};color:white;">
                        <!-- bug da sistemare causato dal modulo tag, stampo l'oggetto -->
                        <i class="ion-pricetag"></i>
                        {{isString(tag) ? tag : tag.tag}}
                        <span></span>
                    </span>

                </span>
            </div>
            <div ng-if="infoPlace.marker.text" class="content modal-content text-field">
                {{infoPlace.marker.text}}
            </div>
            <div ng-if="infoPlace.marker.message_text" class="content modal-content text-field">
                {{infoPlace.marker.message_text}}
            </div>
            <div ng-if="infoPlace.marker.thumbnail" class="content modal-content text-field">
                {{infoPlace.marker.thumbnail}}
            </div>
            <div id="modalPlaceLink" ng-if="infoPlace.marker.link_url" class="content modal-url">

                <a href="{{infoPlace.marker.link_url}}" target="_blank">
                    <i class="ion-link"/>
                    <span>{{infoPlace.marker.link_url}}</span>
                </a>
            </div>
            <div ng-if="config.design.can_permalink && infoPlace.marker.self" id="modalPlacePermalink" class="content modal-url">
                <a href="{{infoPlace.marker.self}}" target="_blank">
                    <i class="ion-link"/>
                    <span>{{'PERMALINK'|translate}}</span>
                </a>
            </div>
        </div>

        <entity-relations ng-if="infoPlace.marker" marker="infoPlace.marker" click="showMCardPlace"></entity-relations>

        <entity-actions ng-if="isLoggedIn && infoPlace.marker" actions="currentType.actions" marker="infoPlace.marker" close="closeModal" label="currentType.name" ></entity-actions>

        <members-list id="infoPlace.marker.id" owner="infoPlace.marker.owner" details="infoPlace.marker.type_info.properties.members" ng-if="infoPlace.marker.type_info.properties.members"></members-list>

        <simple-entity-list ng-if="infoPlace.marker.id" id="infoPlace.marker.id" owner="infoPlace.marker.user" entity-type="infoPlace.marker.type_info.key" logged=isLoggedIn></simple-entity-list>

        <loader ng-if="!infoPlace.marker"></loader>

        <div ng-if="config.dev"><pre>{{infoPlace.marker | json}}</pre></div>
    </ion-content>

    <ion-footer-bar >
        <div class="buttons right-buttons">
            <entity-actions ng-if="infoPlace.marker" actions="currentType.actions" marker="infoPlace.marker" close="closeModal" label="currentType.name" ></entity-actions>
        </div>
        <h1 class="title"></h1>
        <div class="buttons left-buttons">
            <button class="button button-stable button-clear icon ion-close-round" on-tap="closeModal()" ></button>
        </div>
    </ion-footer-bar>
</ion-modal-view>