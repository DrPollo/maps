<ion-header-bar class="modal-header" >
    <div class="bar bar-header">
        <form id="ricerca" name="ricerca" class="item-input-wrapper">
            <i class="icon ion-android-search"></i>
            <input type="search" placeholder="{{'SEARCH'| translate}}" ng-model="query" autofocus >
            <i ng-show="query.length > 0" ng-click="query = '' " class="icon ion-close"></i>
        </form>
    </div>
</ion-header-bar>
<ion-content class="modal-content">
    <div id="cronologia-box" ng-if="bufferSearch.toArray().length > 0">
        <div class="item item-divider">{{'SEARCH_CRONOLOGY'|translate}}</div>
        <div class="list card">
            <div class="icon-left ion-android-time item" ng-repeat="b in bufferSearch.toArray() |filter:{query: '!null'} track by $index" ng-click="cacheRestore($index)">
                {{b.query}}
            </div>
        </div>
    </div>
    <search-results query="query" click="click" close="close"></search-results>

    <div class="item item-divider">
        {{'CURRENTLY_ON_MAP'|translate}}
    </div>
    <div class="item" ng-if="filtered.length == 0">
        <span>{{'NOTHING_TO_SEE'|translate}}</span>
    </div>
    <div ng-if="wallArray.length > 0" class="card list" ng-repeat="marker in wallArray | orderBy:['-last_update','name'] |filter:query as filtered track by $index" >
        <div on-tap="click(marker)" class="item-text-wrap item">
            <i ng-repeat="icon in marker.icons" class="icon {{icon.icon}}"  style="color:{{icon.color}}">
            </i>
            {{marker.name}} 
            <div class="sublist">
                <div class="sublist-block message">
                    {{'LAST_UPDATE_MESSAGE'|translate}} {{marker.last_update | date:'dd/MM/yyyy (hh:mm)'}}
                </div>
            </div>
            <div class="tag-list" ng-if="marker.tags.length > 0">
                <span ng-repeat="tag in marker.tags |filter:'!null' track by $index" class="tag" style="color:{{marker.icons[0].color}};">
                    <i class="ion-pricetag"></i>
                    {{tag}}
                </span>
            </div>
            <div class="sublist" ng-init="loadChildren(marker)">
                <div class="sublist-block list" ng-repeat="(key, rel) in markerChildren[marker.id] track by key" ng-if="rel.list.length > 0">
                    <div class="sublist-title">
                        {{rel.childrenLabel |translate}}
                    </div>
                    <div class="sublist-item item" ng-repeat="c in rel.list track by $index" on-tap="click(c)"> 
                        <i ng-repeat="cIcon in c.icons" class="icon {{cIcon.icon}}"  style="color:{{cIcon.color}}">
                        </i>
                        {{c.name}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</ion-content>